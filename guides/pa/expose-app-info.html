

<!DOCTYPE html>

	<html lang="en-GB">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		
			<title>Expose app info | AEVI AppFlow</title>
		
		
			<meta name="description" content="How to integrate your payment application with AppFlow">
		
		
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:400,400i,500,500i,700,700i">
		<link rel="stylesheet" href="/pos-android-sdk/dox-theme/assets/css/style.css">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="32x32">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="192x192">
		<link rel="apple-touch-icon-precomposed" href="/pos-android-sdk/icon_large.png">
		<meta name="msapplication-TileImage" content="/pos-android-sdk/icon_large.png">
	</head>
	<body>
		
			<div class="c-offcanvas">
				<div class="c-offcanvas__inner">
					
						<ul class="c-nav c-nav--stacked u-mx-auto">
							
								<li><a href="/pos-android-sdk/intro">Introduction</a></li>
							
								<li><a href="/pos-android-sdk/explore">Explore</a></li>
							
								<li><a href="/pos-android-sdk/downloads">Downloads</a></li>
							
								<li><a href="/pos-android-sdk/support">Support</a></li>
							
						</ul><!-- /.c-nav -->
					
					
						
							<a href="/reference" class="c-btn c-btn--md c-btn--gray u-text-md">
								Reference
								<div class="c-btn__icon">
									<i class="o-icon o-icon--folder"></i>
								</div>
							</a>
						
					
				</div><!-- /.c-offcanvas__inner -->
			</div><!-- /.c-offcanvas -->
		

		
			<header class="c-header u-text-white">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12">
							<div class="u-flex u-items-center">
								
									<div class="c-logo">
										<a href="/pos-android-sdk/" class="c-logo__link">
											<img src="/pos-android-sdk/aevi_logo.svg">
										</a><!-- /.c-logo__link -->
									</div><!-- /.c-logo -->
								
								
									<div class="u-flex u-items-center u-ml-auto">
										
											<ul class="c-nav u-mb-0 u-hidden u-block@lg">
												
													
													<li class=""><a href="/pos-android-sdk/intro">Introduction</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/explore">Explore</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/downloads">Downloads</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/support">Support</a></li>
												
											</ul><!-- /.c-nav -->
										
										
											<div class="u-ml-5 u-hidden u-block@lg">
												
													<a href="/pos-android-sdk/reference" class="c-btn c-btn--md c-btn--white u-text-md">
														Reference
														<div class="c-btn__icon">
															<i class="o-icon o-icon--folder"></i>
														</div>
													</a>
												
											</div>
										
									</div>
								
								<button class="c-hamburger-icon c-hamburger-icon--slider js-hamburger-icon js-offcanvas-toggle u-ml-auto u-hidden@lg" type="button">
									<span class="c-hamburger-icon__box">
										<span class="c-hamburger-icon__inner"></span>
									</span><!-- /.c-hamburger-icon__box -->
								</button><!-- /.c-hamburger-icon -->
							</div>
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</header><!-- /.c-header -->
		







	
		<div class="c-hero u-bg-primary u-text-white u-pt-16 u-pb-10">
	
		<div class="o-container">
			<div class="o-row">
				<div class="o-col-10@lg o-col-9@xl">
					
						<h2 class="u-text-lg u-text-xl@sm">Payment Applications</h2>
					
					
						<div class="u-h6">
							<p>Expose info about your application</p>
						</div>
					
					
					
				</div><!-- /.o-col -->
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>






	<div class="u-pt-8 u-pb-5">
		<div class="o-container">
			<div class="o-row">
				
					<div class="o-col-8@lg o-col-7@xl">
						<div class="c-post u-mb-3@lg js-post">
							<h1 id="exposing-application-info">Exposing application info</h1>

<p>In order for your application to be AppFlow compliant, it must expose certain information. It does this via implementing a content provider and exposing it via the application manifest.</p>

<h2 id="adding-the-service-info-provider">Adding the service info provider</h2>

<p>FPS and other applications require certain information about every payment application.</p>

<p>This is done by extending <code class="highlighter-rouge">BasePaymentFlowServiceInfoProvider</code>, as the sample code below shows</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentServiceInfoProvider</span> <span class="kd">extends</span> <span class="n">BasePaymentFlowServiceInfoProvider</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="n">PaymentFlowServiceInfo</span> <span class="nf">getPaymentFlowServiceInfo</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">PaymentFlowServiceInfoBuilder</span><span class="o">()</span>
      <span class="o">.</span><span class="na">withVendor</span><span class="o">(</span><span class="s">"TheVendorName"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">withDisplayName</span><span class="o">(</span><span class="s">"Name of your application for UI presentation"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">withCanPayAmounts</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="o">&lt;</span><span class="n">supportedPaymentMethods</span><span class="o">&gt;)</span>
      <span class="o">.</span><span class="na">withSupportedFlowTypes</span><span class="o">(</span><span class="n">FlowTypes</span><span class="o">.</span><span class="na">SALE</span><span class="o">,</span> <span class="n">FlowTypes</span><span class="o">.</span><span class="na">REFUND</span><span class="o">,</span> <span class="o">...)</span>
      <span class="o">.</span><span class="na">withCustomRequestTypes</span><span class="o">(&lt;</span><span class="n">Any</span> <span class="n">custom</span> <span class="n">types</span> <span class="n">you</span> <span class="n">may</span> <span class="n">support</span><span class="o">&gt;)</span>
      <span class="o">.</span><span class="na">withSupportedCurrencies</span><span class="o">(&lt;</span><span class="n">list</span> <span class="n">of</span> <span class="n">supported</span> <span class="n">currencies</span><span class="o">&gt;)</span>
      <span class="o">.</span><span class="na">withDefaultCurrency</span><span class="o">(&lt;</span><span class="n">optional</span> <span class="k">default</span> <span class="n">currency</span><span class="o">&gt;)</span>
      <span class="o">.</span><span class="na">withMerchants</span><span class="o">(&lt;</span><span class="n">Optional</span> <span class="n">list</span> <span class="n">of</span> <span class="n">Merchant</span> <span class="n">objects</span><span class="o">&gt;)</span>
      <span class="o">.</span><span class="na">withManualEntrySupport</span><span class="o">(&lt;</span><span class="n">whether</span> <span class="n">or</span> <span class="n">not</span> <span class="n">MOTO</span> <span class="n">is</span> <span class="n">supported</span><span class="o">&gt;)</span>
      <span class="o">.</span><span class="na">withSupportsAccessibilityMode</span><span class="o">(&lt;</span><span class="n">whether</span> <span class="n">or</span> <span class="n">not</span> <span class="n">you</span> <span class="n">support</span> <span class="n">visually</span> <span class="n">impaired</span><span class="o">&gt;)</span>
      <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">getContext</span><span class="o">());</span>
  <span class="o">}</span>
  
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">onServiceInfoError</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">String</span> <span class="n">errorType</span><span class="o">,</span> <span class="nd">@NonNull</span> <span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">errorType</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nl">RETRIEVAL_TIME_OUT:</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"Retrieval of service info timed out"</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">case</span> <span class="nl">INVALID_STAGE_DEFINITIONS:</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"Problems with stage definitions: "</span> <span class="o">+</span> <span class="n">errorMessage</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">case</span> <span class="nl">INVALID_SERVICE_INFO:</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"Invalid service info: "</span> <span class="o">+</span> <span class="n">errorMessage</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="returning-paymentflowserviceinfo">Returning PaymentFlowServiceInfo</h3>

<p>See <a href="https://s3-eu-west-1.amazonaws.com/pos-flow-docs/javadocs/latest/payment-flow-service-api/com/aevi/sdk/pos/flow/model/PaymentFlowServiceInfoBuilder.html">PaymentFlowServiceInfoBuilder</a> for complete details of what can be set and the <a href="https://github.com/AEVI-AppFlow/pos-android-sdk/blob/master/PaymentServiceSample/src/main/java/com/aevi/sdk/pos/flow/paymentservicesample/PaymentServiceInfoProvider.java">implementation</a> in the <code class="highlighter-rouge">Payment Service Sample</code>.</p>

<p>The following data <strong>must</strong> be set for payment applications;</p>

<ul>
  <li><code class="highlighter-rouge">withVendor()</code> - The company/organisation providing the service</li>
  <li><code class="highlighter-rouge">withDisplayName()</code> - The name of the application to show to merchants/customers</li>
  <li><code class="highlighter-rouge">withCanPayAmounts()</code> - <code class="highlighter-rouge">true</code> together with what <em>payment methods</em> are supported</li>
  <li><code class="highlighter-rouge">withSupportedFlowTypes()</code> - Define what flow types (payment functions) are supported (such as <code class="highlighter-rouge">sale</code> or <code class="highlighter-rouge">refund</code>). (details further down)</li>
</ul>

<div class="callout callout--warning">
  <p>Note that if you fail to report that your application can pay amounts here, FPS will reject any such attempts.</p>
</div>
<p>In addition, it is <em>strongly</em> recommended that the following data is set <em>if possible</em>;</p>
<ul>
  <li><code class="highlighter-rouge">withSupportedCurrencies()</code> - Restrict what currencies are supported (default is all currencies)</li>
  <li><code class="highlighter-rouge">withDefaultCurrency()</code> - Set the default currency</li>
  <li><code class="highlighter-rouge">withManualEntrySupport()</code> - Whether or not manual entry / MOTO is supported</li>
  <li><code class="highlighter-rouge">withSupportsAccessibilityMode()</code> - Whether or not there is support for visually impaired users</li>
</ul>

<div class="callout callout--info">
  <p>withCustomRequestTypes() can be used to define custom types that are specific to your payment applicaiton. This may be a function to return some particular data like totals, or
     to display such data. It is entirely up to your application what data is required and returned and
      whether your service shows any UI for it or not. In order for other applications to know about this type however, it needs to be advertised. See ShowLoyaltyPointsBalance in the Flow Service Sample for illustration.</p>
</div>
<p>See <a href="/pos-android-sdk/technical/bespoke-data">Bespoke Data</a> for details.</p>

<div class="callout callout--warning">
  <p>Note that this is a synchronous call and you must return a result within a a few seconds or the call will time out and your application will be rejected. If you rely on
  retrieving information remotely or asyncronously that your application has not yet cached, we recommend that your application returns a set of default values immediately and then when the data is available in the app, call BasePaymnentFlowServiceInfoProvider.notifyServiceInfoChange() which will trigger a new call to this method.</p>
</div>

<h3 id="errors">Errors</h3>

<p>Via the optional, but highly recommended, overriden method <code class="highlighter-rouge">onServiceInfoError</code> , your flow service can receive details of when your flow service is rejected for some reason. See <a href="https://s3-eu-west-1.amazonaws.com/pos-flow-docs/javadocs/latest/payment-initiation-api/com/aevi/sdk/flow/constants/ServiceInfoErrors.html">ServiceInfoErrors</a> for a list of possible error types.</p>

<h2 id="expose-via-manifest">Expose via manifest</h2>

<p>The provider needs to be exposed in the application manifest as follows</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;provider</span>
  <span class="na">android:name=</span><span class="s">".PaymentServiceInfoProvider"</span>
  <span class="na">android:authorities=</span><span class="s">"&lt;your_custom_authority&gt;"</span>
  <span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;intent-filter&gt;</span>
      <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.aevi.sdk.flow.action.PROVIDE_SERVICE_INFO"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/provider&gt;</span>

</code></pre></div></div>

<h2 id="notifying-data-changes">Notifying data changes</h2>

<p>If the data reported via <code class="highlighter-rouge">PaymentFlowServiceInfo</code> has changed, you need notify FPS of this.</p>

<p>Call <code class="highlighter-rouge">BasePaymentFlowServiceInfoProvider.notifyServiceInfoChange()</code> statically and FPS will invalidate any cached configuration data for your application and call your provider again to get the new information.</p>

							

						</div><!-- /.c-post -->
					</div><!-- /.o-col -->
				
				
					<div class="o-col-3@lg o-offset-1@lg o-offset-2@xl">
						<ul class="c-page-nav u-sticky u-pin-t-6 u-mt-4 u-mt-1@lg u-mb-1 u-mb-4@lg">
							
							
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/pa/get-started">
												<p class="c-page-nav__heading">Get started</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/pa/pre-requisites">
												<p class="c-page-nav__heading">Dependencies</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/pa/api-overview">
												<p class="c-page-nav__heading">API Overview</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/pa/expose-app-info">
												<p class="c-page-nav__heading">Expose app info</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pa/implementing-services">
												<p class="c-page-nav__heading">Implementing the services</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pa/handling-events">
												<p class="c-page-nav__heading">Handling events</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pa/receipts">
												<p class="c-page-nav__heading">Receipts</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pa/application-guidelines">
												<p class="c-page-nav__heading">Application Guidelines</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pa/next-steps">
												<p class="c-page-nav__heading">Next steps</p>
											</a>
										</li>
									
									
								
							
						</ul><!-- /.c-page-nav -->
					</div><!-- /.o-col -->
				
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>



	
	
		<div class="u-bg-primary u-text-white u-pt-3 u-pt-4@sm u-pb-3 u-pb-4@sm">
			<div class="o-container">
				<div class="o-row">
					<div class="o-col-12 u-text-center">
						<div class="u-inline-block u-flex@sm">
							
							
							 	
							
							 	
							
							 	
							
							 	
								  
									
									
									
									
										<a href="/pos-android-sdk/guides/pa/api-overview" class="c-arrow-link c-arrow-link--prev u-mr-auto">API Overview</a>
									
									
										<a href="/pos-android-sdk/guides/pa/implementing-services" class="c-arrow-link c-arrow-link--next u-ml-auto">Implementing the services</a>
									
								
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
						</div>
					</div><!-- /.o-col -->
				</div><!-- /.o-row -->
			</div><!-- /.o-container -->
		</div>
		

		
			<footer class="c-footer">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12 u-mt-6 u-mt-8@md u-mb-4 u-mb-6@md">
							
								<p class="c-logo u-mb-1">
									AEVI AppFlow
								</p><!-- /.c-logo -->
							
							
								<p>Copyright &copy;2019. - AEVI International GmbH <br>All rights reserved.</p>
							
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</footer><!-- /.c-footer -->
		

		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/vendor/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/scripts.min.js"></script>

		

	</body>
</html>

	

