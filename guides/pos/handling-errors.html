

<!DOCTYPE html>

	<html lang="en-GB">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		
			<title>Handling errors | AEVI AppFlow</title>
		
		
			<meta name="description" content="How to handle error responses from a flow">
		
		
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:400,400i,500,500i,700,700i">
		<link rel="stylesheet" href="/pos-android-sdk/dox-theme/assets/css/style.css">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="32x32">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="192x192">
		<link rel="apple-touch-icon-precomposed" href="/pos-android-sdk/icon_large.png">
		<meta name="msapplication-TileImage" content="/pos-android-sdk/icon_large.png">
	</head>
	<body>
		
			<div class="c-offcanvas">
				<div class="c-offcanvas__inner">
					
						<ul class="c-nav c-nav--stacked u-mx-auto">
							
								<li><a href="/pos-android-sdk/appflow-overview">Overview</a></li>
							
								<li><a href="/pos-android-sdk/guides">Guides</a></li>
							
								<li><a href="/pos-android-sdk/technical">Technical Docs</a></li>
							
						</ul><!-- /.c-nav -->
					
					
						
							<a href="/technical/javadocs" class="c-btn c-btn--md c-btn--gray u-text-md">
								Reference
								<div class="c-btn__icon">
									<i class="o-icon o-icon--folder"></i>
								</div>
							</a>
						
					
				</div><!-- /.c-offcanvas__inner -->
			</div><!-- /.c-offcanvas -->
		

		
			<header class="c-header">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12">
							<div class="u-flex u-items-center">
								
									<div class="c-logo">
										<a href="/pos-android-sdk/" class="c-logo__link">
											<img src="/pos-android-sdk/aevi_logo.svg">
										</a><!-- /.c-logo__link -->
									</div><!-- /.c-logo -->
								
								
									<div class="u-flex u-items-center u-ml-auto">
										
											<ul class="c-nav u-mb-0 u-hidden u-block@lg">
												
													
													<li class=""><a href="/pos-android-sdk/appflow-overview">Overview</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/guides">Guides</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/technical">Technical Docs</a></li>
												
											</ul><!-- /.c-nav -->
										
										
											<div class="u-ml-5 u-hidden u-block@lg">
												
													<a href="/pos-android-sdk/technical/javadocs" class="c-btn c-btn--md c-btn--gray u-text-md">
														Reference
														<div class="c-btn__icon">
															<i class="o-icon o-icon--folder"></i>
														</div>
													</a>
												
											</div>
										
									</div>
								
								<button class="c-hamburger-icon c-hamburger-icon--slider js-hamburger-icon js-offcanvas-toggle u-ml-auto u-hidden@lg" type="button">
									<span class="c-hamburger-icon__box">
										<span class="c-hamburger-icon__inner"></span>
									</span><!-- /.c-hamburger-icon__box -->
								</button><!-- /.c-hamburger-icon -->
							</div>
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</header><!-- /.c-header -->
		







	
		<div class="c-hero u-bg-gray-30 u-pt-16 u-pb-10">
	
		<div class="o-container">
			<div class="o-row">
				<div class="o-col-10@lg o-col-9@xl">
					
						<h2 class="u-text-lg u-text-xl@sm">Flow Initiation</h2>
					
					
						<div class="u-h6">
							<p>How to handle error responses from a flow</p>
						</div>
					
					
					
				</div><!-- /.o-col -->
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>






	<div class="u-pt-8 u-pb-5">
		<div class="o-container">
			<div class="o-row">
				
					<div class="o-col-8@lg o-col-7@xl">
						<div class="c-post u-mb-3@lg js-post">
							<h1 id="handling-errors">Handling Errors</h1>

<p>Flow errors can come in via two channels;</p>
<ul>
  <li>Initiation rx stream <code class="highlighter-rouge">onError</code></li>
  <li>Response listener <code class="highlighter-rouge">notifyError</code></li>
</ul>

<h2 id="initiation-errors">Initiation errors</h2>
<p>When FPS receives a request, it will perform a range of validation on it and any associated flow, as well as ensure that it is currently able to process the request. Any subscriber to the initiate methods must ensure to add a consumer for any <code class="highlighter-rouge">Throwable</code>, as per below. All exceptions thrown by AppFlow will be of type <code class="highlighter-rouge">FlowException</code>, but it is of course possible that unexpected exceptions can occur as well.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>  <span class="n">paymentClient</span><span class="o">.</span><span class="na">initiatePayment</span><span class="o">(</span><span class="n">payment</span><span class="o">).</span><span class="na">subscribe</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="c1">// Request accepted</span>
  <span class="o">},</span> <span class="n">throwable</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">throwable</span> <span class="k">instanceof</span> <span class="n">FlowException</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">FlowException</span> <span class="n">flowException</span> <span class="o">=</span> <span class="o">(</span><span class="n">FlowException</span><span class="o">)</span> <span class="n">throwable</span><span class="o">;</span>
          <span class="n">handleFlowError</span><span class="o">(</span><span class="n">flowException</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">());</span>
          <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"Flow error: "</span> <span class="o">+</span> <span class="n">flowException</span><span class="o">.</span><span class="na">getErrorMessage</span><span class="o">());</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="c1">// Handle unexpected exception</span>
      <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
</div>
<p>The <code class="highlighter-rouge">flowException.getErrorCode()</code> returns a code that can be mapped against the constants in <code class="highlighter-rouge">ErrorConstants</code>, part of the API. See the table below for possible error codes for the initiation stage.</p>

<table>
  <thead>
    <tr>
      <th>Error code</th>
      <th>Error description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>notInstalled</td>
      <td>Sent if the processing service (FPS) is not installed on the device</td>
    </tr>
    <tr>
      <td>busy</td>
      <td>Sent if the processing service (FPS) is already processing a request</td>
    </tr>
    <tr>
      <td>unsupportedOperation</td>
      <td>Sent if an unsupported flow/request type/name is sent to the processing service</td>
    </tr>
    <tr>
      <td>multipleConfigProviders</td>
      <td>Sent if there is more than one configuration provider installed on the device</td>
    </tr>
    <tr>
      <td>noConfigProvider</td>
      <td>Sent if there is no configuration provider installed on the device</td>
    </tr>
    <tr>
      <td>incompatibleApiVersion</td>
      <td>Sent if the client is integrated with a different major API version than the processing service</td>
    </tr>
    <tr>
      <td>invalidRequest</td>
      <td>Sent if the request was malformed or failed validation</td>
    </tr>
    <tr>
      <td>missingResponseListener</td>
      <td>Sent if the client has not defined the relevant response listeners</td>
    </tr>
    <tr>
      <td>invalidMessageType</td>
      <td>Sent in the (rare case) that the <em>message</em> received is invalid or unknown</td>
    </tr>
    <tr>
      <td>cancelFailed</td>
      <td>Sent if the (rare case) where processing service fails to cancel a flow as requested</td>
    </tr>
    <tr>
      <td>resumeFailed</td>
      <td>Sent if the (rare case) where the processing service failed to resume a flow as requested by merchant</td>
    </tr>
  </tbody>
</table>

<h2 id="response-listener-errors">Response listener errors</h2>
<p>Once FPS has accepted your request, it will complete the initiation stream and start processing the flow. After this point, if any errors occur, they will be sent back via the response listener <code class="highlighter-rouge">notifyError</code> method. Most outcomes at this point will lead to an actual <code class="highlighter-rouge">PaymentResponse</code> or <code class="highlighter-rouge">Response</code> being generated with relevant outcomes set, but in rare cases the flow can abruptly end due to misbehaving flow services, device problems, etc. The errors are sent back to the method signature as per below;</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">notifyError</span><span class="p">(</span><span class="n">String</span> <span class="n">errorCode</span><span class="o">,</span> <span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{}</span>
</code></pre>
</div>

<p>In this case, the error code and message have been extracted from the <code class="highlighter-rouge">FlowException</code> and passed directly to the listener. The following error codes are relevant for the response listener. See <code class="highlighter-rouge">ErrorConstants</code> in the API for defined values.</p>

<table>
  <thead>
    <tr>
      <th>Error code</th>
      <th>Error description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>flowServiceError</td>
      <td>A general purpose error that will be sent for fatal failures in a flow service</td>
    </tr>
    <tr>
      <td>stageNotSupported</td>
      <td>Sent if a flow service does not support the stage it has just been called for</td>
    </tr>
    <tr>
      <td>configError</td>
      <td>Sent if the processing service cannot find a handler(s) for a stage</td>
    </tr>
    <tr>
      <td>unexpectedError</td>
      <td>Something unexpected happened</td>
    </tr>
  </tbody>
</table>

							

						</div><!-- /.c-post -->
					</div><!-- /.o-col -->
				
				
					<div class="o-col-3@lg o-offset-1@lg o-offset-2@xl">
						<ul class="c-page-nav u-sticky u-pin-t-6 u-mt-4 u-mt-1@lg u-mb-1 u-mb-4@lg">
							
							
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pos/pre-requisites">
												<p class="c-page-nav__heading">Pre-requisites</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pos/flow-initiation">
												<p class="c-page-nav__heading">Flow initiation</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pos/flow-response-listeners">
												<p class="c-page-nav__heading">Flow response listener</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pos/handling-responses">
												<p class="c-page-nav__heading">Handling responses</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/pos/handling-errors">
												<p class="c-page-nav__heading">Handling errors</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/pos/status-update-flows">
												<p class="c-page-nav__heading">Status update flows</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/pos/querying-for-responses">
												<p class="c-page-nav__heading">Querying for responses</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/pos/querying-for-information">
												<p class="c-page-nav__heading">Querying for information</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/pos/events-subscription">
												<p class="c-page-nav__heading">Event subscription</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/pos/query-for-devices">
												<p class="c-page-nav__heading">Query for devices</p>
											</a>
										</li>
									
									
								
							
						</ul><!-- /.c-page-nav -->
					</div><!-- /.o-col -->
				
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>



	
	
		<div class="u-bg-primary u-text-white u-pt-3 u-pt-4@sm u-pb-3 u-pb-4@sm">
			<div class="o-container">
				<div class="o-row">
					<div class="o-col-12 u-text-center">
						<div class="u-inline-block u-flex@sm">
							
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
								  
									
									
									
									
										<a href="/pos-android-sdk/guides/pos/handling-responses" class="c-arrow-link c-arrow-link--prev u-mr-auto">Handling responses</a>
									
									
										<a href="/pos-android-sdk/guides/pos/status-update-flows" class="c-arrow-link c-arrow-link--next u-ml-auto">Status update flows</a>
									
								
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
						</div>
					</div><!-- /.o-col -->
				</div><!-- /.o-row -->
			</div><!-- /.o-container -->
		</div>
		

		
			<footer class="c-footer">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12 u-mt-6 u-mt-8@md u-mb-4 u-mb-6@md">
							
								<p class="c-logo u-mb-1">
									AEVI AppFlow
								</p><!-- /.c-logo -->
							
							
								<p>Copyright &copy;2019. - AEVI International GmbH <br>All rights reserved.</p>
							
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</footer><!-- /.c-footer -->
		

		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/vendor/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/scripts.min.js"></script>

		

	</body>
</html>

	

