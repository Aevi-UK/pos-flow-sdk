

<!DOCTYPE html>

	<html lang="en-GB">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		
			<title>Flow response listener | AEVI AppFlow</title>
		
		
			<meta name="description" content="Listening for a response using a flow response listener">
		
		
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:400,400i,500,500i,700,700i">
		<link rel="stylesheet" href="/pos-android-sdk/dox-theme/assets/css/style.css">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="32x32">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="192x192">
		<link rel="apple-touch-icon-precomposed" href="/pos-android-sdk/icon_large.png">
		<meta name="msapplication-TileImage" content="/pos-android-sdk/icon_large.png">
	</head>
	<body>
		
			<div class="c-offcanvas">
				<div class="c-offcanvas__inner">
					
						<ul class="c-nav c-nav--stacked u-mx-auto">
							
								<li><a href="/pos-android-sdk/appflow-overview">Introduction</a></li>
							
								<li><a href="/pos-android-sdk/downloads">Downloads</a></li>
							
						</ul><!-- /.c-nav -->
					
					
						
							<a href="/technical/javadocs" class="c-btn c-btn--md c-btn--gray u-text-md">
								Reference
								<div class="c-btn__icon">
									<i class="o-icon o-icon--folder"></i>
								</div>
							</a>
						
					
				</div><!-- /.c-offcanvas__inner -->
			</div><!-- /.c-offcanvas -->
		

		
			<header class="c-header">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12">
							<div class="u-flex u-items-center">
								
									<div class="c-logo">
										<a href="/pos-android-sdk/" class="c-logo__link">
											<img src="/pos-android-sdk/aevi_logo.svg">
										</a><!-- /.c-logo__link -->
									</div><!-- /.c-logo -->
								
								
									<div class="u-flex u-items-center u-ml-auto">
										
											<ul class="c-nav u-mb-0 u-hidden u-block@lg">
												
													
													<li class=""><a href="/pos-android-sdk/appflow-overview">Introduction</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/downloads">Downloads</a></li>
												
											</ul><!-- /.c-nav -->
										
										
											<div class="u-ml-5 u-hidden u-block@lg">
												
													<a href="/pos-android-sdk/technical/javadocs" class="c-btn c-btn--md c-btn--gray u-text-md">
														Reference
														<div class="c-btn__icon">
															<i class="o-icon o-icon--folder"></i>
														</div>
													</a>
												
											</div>
										
									</div>
								
								<button class="c-hamburger-icon c-hamburger-icon--slider js-hamburger-icon js-offcanvas-toggle u-ml-auto u-hidden@lg" type="button">
									<span class="c-hamburger-icon__box">
										<span class="c-hamburger-icon__inner"></span>
									</span><!-- /.c-hamburger-icon__box -->
								</button><!-- /.c-hamburger-icon -->
							</div>
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</header><!-- /.c-header -->
		







	
		<div class="c-hero u-bg-gray-30 u-pt-16 u-pb-10">
	
		<div class="o-container">
			<div class="o-row">
				<div class="o-col-10@lg o-col-9@xl">
					
						<h2 class="u-text-lg u-text-xl@sm">Integrating Value Added Applications</h2>
					
					
						<div class="u-h6">
							<p>Listening for a response using a flow response listener</p>
						</div>
					
					
					
				</div><!-- /.o-col -->
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>






	<div class="u-pt-8 u-pb-5">
		<div class="o-container">
			<div class="o-row">
				
					<div class="o-col-8@lg o-col-7@xl">
						<div class="c-post u-mb-3@lg js-post">
							<h1 id="flow-response-listeners">Flow Response Listeners</h1>

<p>Flow services can optionally define response entry points that are called when the final flow responses are available.</p>

<p>This is how client applications receive responses for the flows they initiate and it may also be useful for your flow service to review the outcome for some reason or have an opportunity to undo changes made in the flow upon errors, cancellations, etc.</p>

<p>As an example, if loyalty points were used and the transaction is later declined or cancelled, it would allow a loyalty app to refund those points back to the customer.</p>

<p>Note that only the <code class="highlighter-rouge">BasePaymentResponseListenerService</code> is relevant for flow services.</p>

<p>This can be done by extending and implementing one of the response listener services. Currently two base listener services are defined:</p>

<ul>
  <li><code class="highlighter-rouge">BaseResponseListenerService</code> - to listen for <code class="highlighter-rouge">Response</code> objects resulting from a initial <code class="highlighter-rouge">Request</code></li>
  <li><code class="highlighter-rouge">BasePaymentResponseListenerService</code> - to listen for <code class="highlighter-rouge">PaymentResponse</code> objects resulting from a <code class="highlighter-rouge">Payment</code> request</li>
</ul>

<h2 id="response-service">Response service</h2>

<p>Response services have two callback methods for responses - one for generic responses, such as for any of the defined <a href="/pos-android-sdk/technical/request-types">request types</a> or custom request types, and one for responses from a <a href="status-update-flows">status update flow</a>. These are delivered separately as many clients may not be interested in responses from status updates.</p>

<p>There is also a callback method for errors that may have occurred during a flow.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResponseListenerService</span> <span class="kd">extends</span> <span class="n">BaseResponseListenerService</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">notifyGenericResponse</span><span class="o">(</span><span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// Handle generic response</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">notifyStatusUpdateResponse</span><span class="o">(</span><span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// Handle (if required) status update response</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">notifyError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorCode</span><span class="o">,</span> <span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Map error code against one of `ErrorConstants`</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="payment-response-service">Payment response service</h2>
<p>Your application should implement the <code class="highlighter-rouge">notifyResponse</code> and <code class="highlighter-rouge">notifyError</code> methods as shown in the example for payment responses below.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentResponseListenerService</span> <span class="kd">extends</span> <span class="n">BasePaymentResponseListenerService</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">notifyResponse</span><span class="o">(</span><span class="n">PaymentResponse</span> <span class="n">paymentResponse</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// Handle response</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">notifyError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorCode</span><span class="o">,</span> <span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// Map error code against one of `ErrorConstants`</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="exposing-services">Exposing services</h2>
<p>The service(s) should be registered in your manifest as normal and should include the correct intent filter as shown below.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;service</span>
  <span class="na">android:name=</span><span class="s">".PaymentResponseListenerService"</span>
  <span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;intent-filter&gt;</span>
      <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.aevi.sdk.flow.action.PROCESS_PAYMENT_RESPONSE"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>

<span class="nt">&lt;service</span>
  <span class="na">android:name=</span><span class="s">".ResponseListenerService"</span>
  <span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;intent-filter&gt;</span>
      <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.aevi.sdk.flow.action.PROCESS_RESPONSE"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</code></pre></div></div>

<p><strong>Note</strong> - A client will only be notified of responses that it itself initiated and flow services will only be notified of responses for <em>payment</em> flows in which it was called.</p>


							

						</div><!-- /.c-post -->
					</div><!-- /.o-col -->
				
				
					<div class="o-col-3@lg o-offset-1@lg o-offset-2@xl">
						<ul class="c-page-nav u-sticky u-pin-t-6 u-mt-4 u-mt-1@lg u-mb-1 u-mb-4@lg">
							
							
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/vaa/pre-requisites">
												<p class="c-page-nav__heading">Pre-requisites</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/vaa/implementing-flow-services">
												<p class="c-page-nav__heading">Implementing Flow Services</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/vaa/integration">
												<p class="c-page-nav__heading">Integration</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/vaa/flow-response-listeners">
												<p class="c-page-nav__heading">Flow response listener</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/application-guidelines">
												<p class="c-page-nav__heading">Application Guidelines</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/use-cases">
												<p class="c-page-nav__heading">Use cases</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/receipt-considerations">
												<p class="c-page-nav__heading">Receipt Applications</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/split-considerations">
												<p class="c-page-nav__heading">Split Applications</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/dealing-with-amounts">
												<p class="c-page-nav__heading">Dealing with Amounts</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/initiating-a-flow">
												<p class="c-page-nav__heading">Initiating a flow</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/references">
												<p class="c-page-nav__heading">References</p>
											</a>
										</li>
									
									
								
							
						</ul><!-- /.c-page-nav -->
					</div><!-- /.o-col -->
				
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>



	
	
		<div class="u-bg-primary u-text-white u-pt-3 u-pt-4@sm u-pb-3 u-pb-4@sm">
			<div class="o-container">
				<div class="o-row">
					<div class="o-col-12 u-text-center">
						<div class="u-inline-block u-flex@sm">
							
							
							 	
							
							 	
							
							 	
							
							 	
								  
									
									
									
									
										<a href="/pos-android-sdk/guides/vaa/integration" class="c-arrow-link c-arrow-link--prev u-mr-auto">Integration</a>
									
									
										<a href="/pos-android-sdk/guides/vaa/application-guidelines" class="c-arrow-link c-arrow-link--next u-ml-auto">Application Guidelines</a>
									
								
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
						</div>
					</div><!-- /.o-col -->
				</div><!-- /.o-row -->
			</div><!-- /.o-container -->
		</div>
		

		
			<footer class="c-footer">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12 u-mt-6 u-mt-8@md u-mb-4 u-mb-6@md">
							
								<p class="c-logo u-mb-1">
									AEVI AppFlow
								</p><!-- /.c-logo -->
							
							
								<p>Copyright &copy;2019. - AEVI International GmbH <br>All rights reserved.</p>
							
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</footer><!-- /.c-footer -->
		

		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/vendor/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/scripts.min.js"></script>

		

	</body>
</html>

	

