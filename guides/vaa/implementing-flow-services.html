

<!DOCTYPE html>

	<html lang="en-GB">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		
			<title>Implementing Flow Services | AEVI AppFlow</title>
		
		
			<meta name="description" content="How to integrate any application with AppFlow to add data or augment the flow">
		
		
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:400,400i,500,500i,700,700i">
		<link rel="stylesheet" href="/pos-android-sdk/dox-theme/assets/css/style.css">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="32x32">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="192x192">
		<link rel="apple-touch-icon-precomposed" href="/pos-android-sdk/icon_large.png">
		<meta name="msapplication-TileImage" content="/pos-android-sdk/icon_large.png">
	</head>
	<body>
		
			<div class="c-offcanvas">
				<div class="c-offcanvas__inner">
					
						<ul class="c-nav c-nav--stacked u-mx-auto">
							
								<li><a href="/pos-android-sdk/appflow-overview">Introduction</a></li>
							
								<li><a href="/pos-android-sdk/downloads">Downloads</a></li>
							
						</ul><!-- /.c-nav -->
					
					
						
							<a href="/technical/javadocs" class="c-btn c-btn--md c-btn--gray u-text-md">
								Reference
								<div class="c-btn__icon">
									<i class="o-icon o-icon--folder"></i>
								</div>
							</a>
						
					
				</div><!-- /.c-offcanvas__inner -->
			</div><!-- /.c-offcanvas -->
		

		
			<header class="c-header">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12">
							<div class="u-flex u-items-center">
								
									<div class="c-logo">
										<a href="/pos-android-sdk/" class="c-logo__link">
											<img src="/pos-android-sdk/aevi_logo.svg">
										</a><!-- /.c-logo__link -->
									</div><!-- /.c-logo -->
								
								
									<div class="u-flex u-items-center u-ml-auto">
										
											<ul class="c-nav u-mb-0 u-hidden u-block@lg">
												
													
													<li class=""><a href="/pos-android-sdk/appflow-overview">Introduction</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/downloads">Downloads</a></li>
												
											</ul><!-- /.c-nav -->
										
										
											<div class="u-ml-5 u-hidden u-block@lg">
												
													<a href="/pos-android-sdk/technical/javadocs" class="c-btn c-btn--md c-btn--gray u-text-md">
														Reference
														<div class="c-btn__icon">
															<i class="o-icon o-icon--folder"></i>
														</div>
													</a>
												
											</div>
										
									</div>
								
								<button class="c-hamburger-icon c-hamburger-icon--slider js-hamburger-icon js-offcanvas-toggle u-ml-auto u-hidden@lg" type="button">
									<span class="c-hamburger-icon__box">
										<span class="c-hamburger-icon__inner"></span>
									</span><!-- /.c-hamburger-icon__box -->
								</button><!-- /.c-hamburger-icon -->
							</div>
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</header><!-- /.c-header -->
		







	
		<div class="c-hero u-bg-gray-30 u-pt-16 u-pb-10">
	
		<div class="o-container">
			<div class="o-row">
				<div class="o-col-10@lg o-col-9@xl">
					
						<h2 class="u-text-lg u-text-xl@sm">Integrating Value Added Applications</h2>
					
					
						<div class="u-h6">
							<p>How to implement a flow service</p>
						</div>
					
					
					
				</div><!-- /.o-col -->
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>






	<div class="u-pt-8 u-pb-5">
		<div class="o-container">
			<div class="o-row">
				
					<div class="o-col-8@lg o-col-7@xl">
						<div class="c-post u-mb-3@lg js-post">
							<h1 id="implementing-flow-services">Implementing flow services</h1>

<p>There are three types of flow; <em>payment</em>, <em>generic</em> and <em>status updates</em>. These flows may have one or multiple stages defined. Any given application with a particular purpose will fit into AppFlow via what stage it will be called in.</p>

<p><a href="/pos-android-sdk/flow-stages">More details of flow stages can be found here</a>.</p>

<h2 id="defining-the-stage-entry-points">Defining the stage entry points</h2>

<p>Depending on the needs and requirements of your application, there are different approaches to defining your entry points for your service to be called.</p>

<p>If your service supports multiple stages where the majority can be handled without presenting a UI, the best option is to extend <code class="highlighter-rouge">BasePaymentFlowService</code>, which gives you callbacks into a service for each stage and gives you full freedom to choose how to handle that request.</p>

<p>If on the other hand all your request handling involves user interaction, looking at the <code class="highlighter-rouge">ActivityProxyService</code> to delegate straight to your activities might be a better option.</p>

<p>Before we look at these two options, we need to cover <em>stage models</em>, which are the models your service will be working with to read and augment data for any given stage.</p>

<h3 id="stage-models">Stage models</h3>
<p>As each stage of the flow typically deals with different input and output data, there is generally one stage model defined per stage. The one exception is for <code class="highlighter-rouge">PRE_TRANSACTION</code> and <code class="highlighter-rouge">POST_CARD_READING</code>, where they do in fact share the same data types and same rules, meaning they also share the model.</p>

<p>All the stage models provide a similar set of functions,</p>

<ul>
  <li>Initialise from a service context</li>
  <li>Initialise from an activity context</li>
  <li>Get the request (input data) for this stage</li>
  <li>A number of augmentation functions</li>
  <li>A method to send the response</li>
  <li>Start an activity to handle the request (from a service context)</li>
</ul>

<p>In addition, the stage models set up some interaction points with the API behind the scenes to reduce the amount of boilerplate required for app developers.</p>

<p>See <a href="https://github.com/Aevi-UK/pos-flow-sdk/blob/master/payment-flow-service-api/src/main/java/com/aevi/sdk/pos/flow/stage/PreTransactionModel.java">PreTransactionModel</a> for an example of a stage model.</p>

<p>Below you can find a table which outlines what intent actions and stage models to use for each stage.</p>

<h3 id="extending-basepaymentflowservice">Extending BasePaymentFlowService</h3>
<p>The <code class="highlighter-rouge">BasePaymentFlowService</code>, contains a method per stage that a subclass can override to handle that particular stage.</p>

<p>An example of such a method is,</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPreFlow</span><span class="o">(</span><span class="n">PreFlowModel</span> <span class="n">model</span><span class="o">)</span> <span class="o">{}</span>
</code></pre></div></div>

<p>Here is an example of an implementation of this from the <a href="https://github.com/AEVI-AppFlow/pos-android-sdk/blob/master/PaymentServiceSample/src/main/java/com/aevi/sdk/pos/flow/paymentservicesample/service/PaymentService.java#L29"><code class="highlighter-rouge">Payment Service Sample</code></a>. It illustrates how some stages can be delegated to activities, and others to be handled from the service context itself.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentService</span> <span class="kd">extends</span> <span class="n">BasePaymentFlowService</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPaymentCardReading</span><span class="o">(</span><span class="n">CardReadingModel</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">model</span><span class="o">.</span><span class="na">processInActivity</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">PaymentCardReadingActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onTransactionProcessing</span><span class="o">(</span><span class="n">TransactionProcessingModel</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">model</span><span class="o">.</span><span class="na">processInActivity</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">TransactionProcessingActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onGeneric</span><span class="o">(</span><span class="n">GenericStageModel</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">GenericStageHandler</span><span class="o">.</span><span class="na">handleGenericRequest</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onForceFinish</span><span class="o">(</span><span class="n">ClientCommunicator</span> <span class="n">clientCommunicator</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">.</span><span class="na">onForceFinish</span><span class="o">(</span><span class="n">clientCommunicator</span><span class="o">);</span> <span class="c1">// be sure to call the super method here for auto finish</span>

      <span class="c1">// Finish up anything you might have started in here. Activities started via `processInActivity` will</span>
      <span class="c1">// be finished automatically and any response sent here will be ignored</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This is defined in the <a href="https://github.com/AEVI-AppFlow/pos-android-sdk/blob/master/PaymentServiceSample/src/main/AndroidManifest.xml#L18">manifest</a> as follow,</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;service</span>
    <span class="na">android:name=</span><span class="s">".service.PaymentService"</span>
    <span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.aevi.sdk.flow.action.PROCESS_GENERIC"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.aevi.sdk.flow.action.READ_PAYMENT_CARD"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.aevi.sdk.flow.action.PROCESS_TRANSACTION"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</code></pre></div></div>

<p>In order for your application to be called at a specific stage it must expose the appropriate action intent-filter as shown above. <a href="https://github.com/AEVI-AppFlow/pos-android-sdk/blob/release/2.1.0/flow-base-api/src/main/java/com/aevi/sdk/flow/constants/IntentActions.java">A full list of these can be found here</a></p>

<h3 id="using-activityproxyservice">Using ActivityProxyService</h3>
<p><code class="highlighter-rouge">ActivityProxyService</code> is a service defined in the API that can be used to proxy through any request to an activity. This is useful if all your requests handling requires user interaction, as you can avoid setting up pure boilerplate services just to start activities.</p>

<p>The service is defined in the manifest as follows, where you choose which stages you want to handle via the intent actions. The example below is set up for <code class="highlighter-rouge">PRE_FLOW</code> only.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;service</span>
    <span class="na">android:name=</span><span class="s">"com.aevi.sdk.pos.flow.service.ActivityProxyService"</span>
    <span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.aevi.sdk.flow.action.PROCESS_PRE_FLOW"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</code></pre></div></div>

<p>You then need to define an activity for each stage you want the requests proxied to, as per below for PRE_FLOW. Pay attention to the intent action.</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;activity</span>
    <span class="na">android:name=</span><span class="s">".ui.PreFlowActivity"</span>
    <span class="na">android:excludeFromRecents=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.aevi.sdk.flow.action.PROCESS_PRE_FLOW_IN_ACTIVITY"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/activity&gt;</span>
</code></pre></div></div>

<p>The way the <code class="highlighter-rouge">ActivityProxyService</code> looks up what activity to delegate to is via the stage name. It will build the intent action as follows,
<code class="highlighter-rouge">intentAction = "com.aevi.sdk.flow.action.PROCESS_" + stageName + "_IN_ACTIVITY"</code>.</p>

<p>Once your activity is created (via <code class="highlighter-rouge">onCreate()</code>, you can then initialise the stage model from the static <code class="highlighter-rouge">fromActivity()</code> method, as per below for <code class="highlighter-rouge">PRE_FLOW</code>;</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_pre_flow</span><span class="o">);</span>
    <span class="n">PreFlowModel</span> <span class="n">preFlowModel</span> <span class="o">=</span> <span class="n">PreFlowModel</span><span class="o">.</span><span class="na">fromActivity</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The models only keep a weak reference to your activities, so there are no risks of activity memory leaks via the models even if your code passes these onto other classes in your application.</p>

<h2 id="defining-the-generic-stage-entry-points">Defining the generic stage entry points</h2>

<p>In addition to being called for payment flows, your application can also handle what we refer to as <em>generic</em> requests that applications can initiate via the client APIs. These generic requests may be of well-defined types like <em>tokenisation</em>, or be custom for a particular app or group of apps. There is an example in the <code class="highlighter-rouge">initiation sample application</code> that calls into the <code class="highlighter-rouge">flow service sample</code> to show loyalty point balance.</p>

<p>There are only two possible stages for generic</p>

<ul>
  <li><code class="highlighter-rouge">GENERIC</code></li>
  <li><code class="highlighter-rouge">POST_GENERIC</code></li>
</ul>

<p>See <a href="/pos-android-sdk/flow-stages">Flow Stages</a> for details on the stages.</p>

<p>As outlined earlier, the stages can be handled via the <code class="highlighter-rouge">BasePaymentFlowService</code> and <code class="highlighter-rouge">ActivityProxyService</code>. In addition, for generic stages, there are also specific base classes (due to the fact that generic requests are part of the AppFlow <em>base APIs</em> and not unique to the POS implementation of AppFlow).</p>

<p>See <code class="highlighter-rouge">BaseGenericService</code> and <code class="highlighter-rouge">BasePostGenericService</code> for base classes specifically for these stages. These are demonstrated via the samples as well. These may be preferred if your service is <em>only</em> interested in generic flows, otherwise the other options above are more suitable.</p>

<h2 id="defining-status-update-entry-point">Defining status update entry point</h2>

<p><a href="/pos-android-sdk/guides/pos/status-update-flows">Status update flows</a> are a bit different in that they are processed in the <em>background</em> and requests are submitted to a <em>request queue</em>. They can be processed in parallel to the standard payment and generic flows.</p>

<p>Applications that process status updates must only run in the background - i.e handle the update in the service and not launch any activities. Applications can choose to finish without passing back any data to the client via the <code class="highlighter-rouge">finish()</code> method in the model, or pass back a set of references via the <code class="highlighter-rouge">finishWithReferences()</code> method.</p>

<p>To handle these updates, either extend the <code class="highlighter-rouge">BaseStatusUpdateService</code> or override <code class="highlighter-rouge">onStatusUpdate()</code> method in a <code class="highlighter-rouge">BasePaymentFlowService</code> implementation.</p>

<h2 id="stages-summary">Stages summary</h2>

<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Intent Action</th>
      <th>Stage model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">PRE_FLOW</code></td>
      <td><code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_PRE_FLOW</code></td>
      <td><code class="highlighter-rouge">PreFlowModel</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">SPLIT</code></td>
      <td><code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_SPLIT</code></td>
      <td><code class="highlighter-rouge">SplitModel</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">PRE_TRANSACTION</code></td>
      <td><code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_PRE_TRANSACTION</code></td>
      <td><code class="highlighter-rouge">PreTransactionModel</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">POST_CARD_READING</code></td>
      <td><code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_POST_CARD_READING</code></td>
      <td><code class="highlighter-rouge">PreTransactionModel</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">POST_TRANSACTION</code></td>
      <td><code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_POST_TRANSACTION</code></td>
      <td><code class="highlighter-rouge">PostTransactionModel</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">POST_FLOW</code></td>
      <td><code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_POST_FLOW</code></td>
      <td><code class="highlighter-rouge">PostFlowModel</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">GENERIC</code></td>
      <td><code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_GENERIC</code></td>
      <td><code class="highlighter-rouge">GenericModel</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">POST_GENERIC</code></td>
      <td><code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_POST_GENERIC</code></td>
      <td><code class="highlighter-rouge">PostGenericModel</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">STATUS_UPDATE</code></td>
      <td><code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_StatusUpdate</code></td>
      <td><code class="highlighter-rouge">StatusUpdateModel</code></td>
    </tr>
  </tbody>
</table>

<h2 id="asynchronous-request-handling">Asynchronous request handling</h2>
<p>A flow service can handle a request asynchronously in a fire-and-forget fashion where FPS does not wait for any response. This is mainly useful for the “post” stages where there may be apps that are interested in the outcome of things (such as for analytics), but do not want to provide any input back or delay the processing completion.</p>

<p>Any flow service can do this via simply returning back an empty response immediately from the model (finish(), skip(), etc) and then continuing to execute. It is up to each flow service if and when the service is stopped as described in a section below.</p>

<h2 id="undoing-your-augmentation">Undoing your augmentation</h2>

<p>Due to the nature of services getting called in sequence, where an outcome is determined somewhere in the middle, it is possible that a flow will be cancelled, declined or otherwise aborted before it is successfully completed. This means that any action you performed at a stage earlier in the flow, like using a customers loyalty points for a purchase, is now invalid.</p>

<p>To mitigate this and allow a flow service to undo previously made changes, AppFlow supports <em>response listeners</em>, which is a separate entry point into your application to which a <code class="highlighter-rouge">PaymentResponse</code> or <code class="highlighter-rouge">Response</code> is passed so that your application can review the outcome.</p>

<p>See <a href="/pos-android-sdk/guides/pos/flow-response-listeners">Flow Response Listeners</a> for more information.</p>

<h2 id="service-lifecycle">Service lifecycle</h2>
<p>AppFlow does not ever stop your service. It is entirely up to your implementation if the service should remain running in the background (until Android kills it) and accepts requests, or shut down after each request has been handled via a call to <code class="highlighter-rouge">stopSelf()</code>.</p>

<p>You can also call <code class="highlighter-rouge">setStopServiceOnEndOfStream(true)</code> from the service to indicate that you want the service to automatically be stopped after the client (FPS) has closed the connection.</p>

<p>Do note however that if you wish to process data in the background / asynchronously to the flow (via passing back an empty response and continuing parsing the input data - typically for analytics, etc), you need to ensure you don’t call the above method or <code class="highlighter-rouge">stopSelf()</code> too early.</p>

<h2 id="supported-flow-types">Supported flow types</h2>
<p>Via the <code class="highlighter-rouge">PaymentFlowServiceInfo</code> model, your service will be reporting various details, including what flow types are supported and whether the service supports any <em>custom</em> request types.</p>

<p>Most flow services will be supporting a specific set of flow types, like <em>sale</em> or <em>refund</em> or <em>tokenisation</em>. As an example, a loyalty application would typically only be applicable to <em>sale</em> flows.</p>

<p>It is important to understand here that the flow types reported by a flow service does not automatically enable a client to initiate those types. What a client can initiate is entirely based on the defined flows and their associated flow types. It is possible for a flow service to support a type for which there is no flow and for a flow to list a flow service for a type it does not support.</p>

<p>The latter scenario is where the supported flow types reported from the flow service comes into effect. FPS will ensure that a flow service that does not support a given type does not get called. This is to ensure that flow services do not need to worry about handling unsupported types.</p>

<p>However, there are use cases where a flow service may <em>want</em> to get called for any type and handle it on its own, in which case it can leave the supported flow types set empty, which means FPS will always allow any type for request to be sent to it.</p>

<h2 id="defining-custom-types">Defining custom types</h2>
<p>In addition to specifying support for the pre-defined types like <em>sale</em> etc, a flow service can also define a new custom type via the <code class="highlighter-rouge">PaymentFlowServiceInfo</code>. It is possible for a flow service to only support custom request types and none of the pre-defined types.</p>

<p>An example of a custom request type can be found in the <code class="highlighter-rouge">Flow Service Sample</code>, which defines <code class="highlighter-rouge">showLoyaltyPointsBalance</code> as a type, allowing a client to initiate a request which will show a customer their loyalty points balance.</p>

<p>If your custom request requires input data and/or contains output data, please see <a href="/pos-android-sdk/technical/reference-values">Reference Values</a>.</p>

<h2 id="appflow-actions">AppFlow actions</h2>
<p>AppFlow provides the merchant with flow controls via a standard sticky Android notification. The possible actions a merchant can choose here are</p>
<ul>
  <li><em>Cancel</em> - Cancel the flow (only applicable to <code class="highlighter-rouge">PRE_FLOW</code> and <code class="highlighter-rouge">SPLIT</code>)</li>
  <li><em>Resume</em> - Resume the current step (if merchant left the activity for some reason)</li>
  <li><em>Skip</em> - Skip this step (not applicable to all stages)</li>
</ul>

<p>These choices can lead to two outcomes for your service, documented below.</p>

<h3 id="resume">Resume</h3>
<p>If your service is handling a request in an activity, and the merchant/operator presses the home button, or otherwise leave that activity, they may then choose to resume it later via the notification. This means your activity (provided it follows the <a href="application-guidelines">AppFlow Guidelines</a>, may then be re-created.</p>

<h3 id="force-finish">Force finish</h3>
<p>If the merchant cancels the flow, or chooses to skip the application via the notification, or your service times out, your service will receive a “force finish” request. At this stage, your service can no longer send back a response and you must shut down any UI or other processing in progress.</p>


							

						</div><!-- /.c-post -->
					</div><!-- /.o-col -->
				
				
					<div class="o-col-3@lg o-offset-1@lg o-offset-2@xl">
						<ul class="c-page-nav u-sticky u-pin-t-6 u-mt-4 u-mt-1@lg u-mb-1 u-mb-4@lg">
							
							
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/vaa/pre-requisites">
												<p class="c-page-nav__heading">Pre-requisites</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li>
											<a href="/pos-android-sdk/guides/vaa/implementing-flow-services">
												<p class="c-page-nav__heading">Implementing Flow Services</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/integration">
												<p class="c-page-nav__heading">Integration</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/flow-response-listeners">
												<p class="c-page-nav__heading">Flow response listener</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/application-guidelines">
												<p class="c-page-nav__heading">Application Guidelines</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/use-cases">
												<p class="c-page-nav__heading">Use cases</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/receipt-considerations">
												<p class="c-page-nav__heading">Receipt Applications</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/split-considerations">
												<p class="c-page-nav__heading">Split Applications</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/dealing-with-amounts">
												<p class="c-page-nav__heading">Dealing with Amounts</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/initiating-a-flow">
												<p class="c-page-nav__heading">Initiating a flow</p>
											</a>
										</li>
									
									
								
							
								
								
									
										<li class="is-active">
											<a href="/pos-android-sdk/guides/vaa/references">
												<p class="c-page-nav__heading">References</p>
											</a>
										</li>
									
									
								
							
						</ul><!-- /.c-page-nav -->
					</div><!-- /.o-col -->
				
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>



	
	
		<div class="u-bg-primary u-text-white u-pt-3 u-pt-4@sm u-pb-3 u-pb-4@sm">
			<div class="o-container">
				<div class="o-row">
					<div class="o-col-12 u-text-center">
						<div class="u-inline-block u-flex@sm">
							
							
							 	
							
							 	
								  
									
									
									
									
										<a href="/pos-android-sdk/guides/vaa/pre-requisites" class="c-arrow-link c-arrow-link--prev u-mr-auto">Pre-requisites</a>
									
									
										<a href="/pos-android-sdk/guides/vaa/integration" class="c-arrow-link c-arrow-link--next u-ml-auto">Integration</a>
									
								
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
							 	
							
						</div>
					</div><!-- /.o-col -->
				</div><!-- /.o-row -->
			</div><!-- /.o-container -->
		</div>
		

		
			<footer class="c-footer">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12 u-mt-6 u-mt-8@md u-mb-4 u-mb-6@md">
							
								<p class="c-logo u-mb-1">
									AEVI AppFlow
								</p><!-- /.c-logo -->
							
							
								<p>Copyright &copy;2019. - AEVI International GmbH <br>All rights reserved.</p>
							
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</footer><!-- /.c-footer -->
		

		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/vendor/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/scripts.min.js"></script>

		

	</body>
</html>

	

