

<!DOCTYPE html>

	<html lang="en-GB">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		
			<title>Receipts and Related Flows | AEVI AppFlow</title>
		
		
		
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:400,400i,500,500i,700,700i">
		<link rel="stylesheet" href="/pos-android-sdk/dox-theme/assets/css/style.css">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="32x32">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="192x192">
		<link rel="apple-touch-icon-precomposed" href="/pos-android-sdk/icon_large.png">
		<meta name="msapplication-TileImage" content="/pos-android-sdk/icon_large.png">
	</head>
	<body>
		
			<div class="c-offcanvas">
				<div class="c-offcanvas__inner">
					
						<ul class="c-nav c-nav--stacked u-mx-auto">
							
								<li><a href="/pos-android-sdk/intro">Introduction</a></li>
							
								<li><a href="/pos-android-sdk/explore">Explore</a></li>
							
								<li><a href="/pos-android-sdk/downloads">Downloads</a></li>
							
								<li><a href="/pos-android-sdk/support">Support</a></li>
							
						</ul><!-- /.c-nav -->
					
					
						
							<a href="/reference" class="c-btn c-btn--md c-btn--gray u-text-md">
								Reference
								<div class="c-btn__icon">
									<i class="o-icon o-icon--folder"></i>
								</div>
							</a>
						
					
				</div><!-- /.c-offcanvas__inner -->
			</div><!-- /.c-offcanvas -->
		

		
			<header class="c-header u-text-white">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12">
							<div class="u-flex u-items-center">
								
									<div class="c-logo">
										<a href="/pos-android-sdk/" class="c-logo__link">
											<img src="/pos-android-sdk/aevi_logo.svg">
										</a><!-- /.c-logo__link -->
									</div><!-- /.c-logo -->
								
								
									<div class="u-flex u-items-center u-ml-auto">
										
											<ul class="c-nav u-mb-0 u-hidden u-block@lg">
												
													
													<li class=""><a href="/pos-android-sdk/intro">Introduction</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/explore">Explore</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/downloads">Downloads</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/support">Support</a></li>
												
											</ul><!-- /.c-nav -->
										
										
											<div class="u-ml-5 u-hidden u-block@lg">
												
													<a href="/pos-android-sdk/reference" class="c-btn c-btn--md c-btn--white u-text-md">
														Reference
														<div class="c-btn__icon">
															<i class="o-icon o-icon--folder"></i>
														</div>
													</a>
												
											</div>
										
									</div>
								
								<button class="c-hamburger-icon c-hamburger-icon--slider js-hamburger-icon js-offcanvas-toggle u-ml-auto u-hidden@lg" type="button">
									<span class="c-hamburger-icon__box">
										<span class="c-hamburger-icon__inner"></span>
									</span><!-- /.c-hamburger-icon__box -->
								</button><!-- /.c-hamburger-icon -->
							</div>
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</header><!-- /.c-header -->
		


<div class="u-bg-primary u-text-white u-pt-8 u-pb-10">
</div>


		<div class="o-container">
			<div class="o-row">
				<div class="o-col-8@lg o-col-7@xl">
						<h2 class="u-text-lg u-text-xl@sm">Receipts and Related Flows</h2>
				</div>
			</div>
		</div>
		<div class="o-container">
			<div class="o-row">
				
					<div class="o-col-12@lg o-col-11@xl">
						<div class="c-post u-mb-3@lg js-post">
							<p>Receipts are typically generated for any payment flow, but there are scenarios where client applications may want to initiate specific receipt requests.</p>

<h2 id="receipt-redelivery">Receipt redelivery</h2>
<p>If the merchant and/or customer needs a receipt to get redelivered (via whatever delivery mechanism the receipt app on that device uses, such as printing), the client application can initiate a <code class="highlighter-rouge">receiptDelivery</code> request. For this type of request. The request will contain information from the previous transaction which will be sent along with the request as additional data.</p>

<h3 id="create-request-from-a-previous-transaction">Create Request from a Previous Transaction</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// First, retrieve the previous transaction to use for the request</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">paymentResponse</span><span class="o">.</span><span class="na">getTransactions</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">desiredTxnIndex</span><span class="o">);</span>

<span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">"receiptDelivery"</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">addAdditionalData</span><span class="o">(</span><span class="s">"transaction"</span><span class="o">,</span> <span class="n">transaction</span><span class="o">);</span>

<span class="c1">// If the receipt handling application supports more than one delivery mechanism</span>
<span class="n">request</span><span class="o">.</span><span class="na">addAdditionalData</span><span class="o">(</span><span class="s">"deliveryMechanism"</span><span class="o">,</span> <span class="s">"printing"</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="create-request-for-a-generic-receipt">Create Request for a Generic Receipt</h3>
<p>If the merchant and/or customer needs a receipt for a non-card based payment e.g. cash. Then a request can be made with different additional data that can fulfil this type of request.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">"receiptDelivery"</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">addAdditionalData</span><span class="o">(</span><span class="s">"receiptAmounts"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Amounts</span><span class="o">(</span><span class="mi">15000</span><span class="o">,</span> <span class="s">"EUR"</span><span class="o">));</span>
<span class="n">request</span><span class="o">.</span><span class="na">addAdditionalData</span><span class="o">(</span><span class="s">"receiptPaymentMethod"</span><span class="o">,</span> <span class="s">"cash"</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">addAdditionalData</span><span class="o">(</span><span class="s">"receiptOutcome"</span><span class="o">,</span> <span class="s">"APPROVED"</span><span class="o">);</span>

</code></pre></div></div>

<p>Optionally a basket can also be added to the request using the key “receiptBasket” e.g.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Basket</span> <span class="n">basket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Basket</span><span class="o">();</span>

<span class="c1">// populate basket</span>
<span class="n">request</span><span class="o">.</span><span class="na">addAdditionalData</span><span class="o">(</span><span class="s">"receiptBasket"</span><span class="o">,</span> <span class="n">basket</span><span class="o">);</span>

</code></pre></div></div>

<h2 id="create-response">Create Response</h2>
<p>Receipt delivery flow services should ensure that they handle both types of request described above for re-delivery of a receipt as well as receipts for non-card based payments.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">AdditionalData</span> <span class="n">requestData</span> <span class="o">=</span> <span class="n">genericStageModel</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getRequestData</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">requestData</span><span class="o">.</span><span class="na">hasData</span><span class="o">(</span><span class="s">"transaction"</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">requestData</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span><span class="s">"transaction"</span><span class="o">,</span> <span class="n">Transaction</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">// If you want to re-use functionality in your application from printing payment transactions.</span>
    <span class="c1">// You may want to create your own `TransactionSummary` object at this point from the `Transaction` e.g.</span>
    <span class="n">TransactionSummary</span> <span class="n">transactionSummary</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TransactionSummary</span><span class="o">(</span><span class="n">transaction</span><span class="o">,</span>
    <span class="s">"receiptDelivery"</span><span class="o">,</span> <span class="n">DeviceAudience</span><span class="o">.</span><span class="na">CUSTOMER</span><span class="o">,</span> <span class="n">transaction</span><span class="o">.</span><span class="na">getLastResponse</span><span class="o">().</span><span class="na">getCard</span><span class="o">()))</span>

    <span class="c1">// handle printing of transactionSummary here</span>

<span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">requestData</span><span class="o">.</span><span class="na">hasData</span><span class="o">(</span><span class="s">"receiptPaymentMethod"</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">Amounts</span> <span class="n">amounts</span> <span class="o">=</span> <span class="n">requestData</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span><span class="s">"receiptAmounts"</span><span class="o">,</span> <span class="n">Amounts</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">paymentMethod</span> <span class="o">=</span> <span class="n">requestData</span><span class="o">.</span><span class="na">getStringValue</span><span class="o">(</span><span class="s">"receiptPaymentMethod"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">requestData</span><span class="o">.</span><span class="na">getStringValue</span><span class="o">(</span><span class="s">"receiptOutcome"</span><span class="o">);</span>

    <span class="c1">// handle printing from the above fields here</span>

<span class="o">}</span>

<span class="c1">// If the receipt was successfully delivered, outcome should be `true`, and `false` otherwise.</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Response</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="o">&lt;</span><span class="n">outcome</span><span class="o">&gt;,</span> <span class="o">&lt;</span><span class="n">outcome</span> <span class="n">message</span><span class="o">&gt;);</span>
<span class="c1">// Setting the delivery mechanism is optional but may be useful for the client application</span>
<span class="n">response</span><span class="o">.</span><span class="na">addAdditionalData</span><span class="o">(</span><span class="s">"deliveryMechanism"</span><span class="o">,</span> <span class="s">"printing"</span><span class="o">);</span>

</code></pre></div></div>
<h2 id="parse-response">Parse Response</h2>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">wasSuccessful</span><span class="o">())</span> <span class="o">{</span>
    <span class="c1">// Handle success</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="c1">// Handle failure</span>
<span class="o">}</span>
</code></pre></div></div>

							

						</div><!-- /.c-post -->
					</div><!-- /.o-col -->
				
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->




		
			<footer class="c-footer">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12 u-mt-6 u-mt-8@md u-mb-4 u-mb-6@md">
							
								<p class="c-logo u-mb-1">
									AEVI AppFlow
								</p><!-- /.c-logo -->
							
							
								<p>Copyright &copy;2019. - AEVI International GmbH <br>All rights reserved.</p>
							
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</footer><!-- /.c-footer -->
		

		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/vendor/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/scripts.min.js"></script>

		

	</body>
</html>

