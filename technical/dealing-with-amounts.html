

<!DOCTYPE html>

	<html lang="en-GB">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		
			<title>Dealing With Amounts | AEVI AppFlow</title>
		
		
		
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:400,400i,500,500i,700,700i">
		<link rel="stylesheet" href="/pos-android-sdk/dox-theme/assets/css/style.css">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="32x32">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="192x192">
		<link rel="apple-touch-icon-precomposed" href="/pos-android-sdk/icon_large.png">
		<meta name="msapplication-TileImage" content="/pos-android-sdk/icon_large.png">
	</head>
	<body>
		
			<div class="c-offcanvas">
				<div class="c-offcanvas__inner">
					
						<ul class="c-nav c-nav--stacked u-mx-auto">
							
								<li><a href="/pos-android-sdk/intro">Introduction</a></li>
							
								<li><a href="/pos-android-sdk/explore">Explore</a></li>
							
								<li><a href="/pos-android-sdk/downloads">Downloads</a></li>
							
								<li><a href="/pos-android-sdk/support">Support</a></li>
							
						</ul><!-- /.c-nav -->
					
					
						
							<a href="/reference" class="c-btn c-btn--md c-btn--gray u-text-md">
								Reference
								<div class="c-btn__icon">
									<i class="o-icon o-icon--folder"></i>
								</div>
							</a>
						
					
				</div><!-- /.c-offcanvas__inner -->
			</div><!-- /.c-offcanvas -->
		

		
			<header class="c-header">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12">
							<div class="u-flex u-items-center">
								
									<div class="c-logo">
										<a href="/pos-android-sdk/" class="c-logo__link">
											<img src="/pos-android-sdk/aevi_logo.svg">
										</a><!-- /.c-logo__link -->
									</div><!-- /.c-logo -->
								
								
									<div class="u-flex u-items-center u-ml-auto">
										
											<ul class="c-nav u-mb-0 u-hidden u-block@lg">
												
													
													<li class=""><a href="/pos-android-sdk/intro">Introduction</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/explore">Explore</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/downloads">Downloads</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/support">Support</a></li>
												
											</ul><!-- /.c-nav -->
										
										
											<div class="u-ml-5 u-hidden u-block@lg">
												
													<a href="/pos-android-sdk/reference" class="c-btn c-btn--md c-btn--gray u-text-md">
														Reference
														<div class="c-btn__icon">
															<i class="o-icon o-icon--folder"></i>
														</div>
													</a>
												
											</div>
										
									</div>
								
								<button class="c-hamburger-icon c-hamburger-icon--slider js-hamburger-icon js-offcanvas-toggle u-ml-auto u-hidden@lg" type="button">
									<span class="c-hamburger-icon__box">
										<span class="c-hamburger-icon__inner"></span>
									</span><!-- /.c-hamburger-icon__box -->
								</button><!-- /.c-hamburger-icon -->
							</div>
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</header><!-- /.c-header -->
		


<div class="u-bg-gray-30 u-pt-8 u-pb-10">
</div>


		<div class="o-container">
			<div class="o-row">
				<div class="o-col-8@lg o-col-7@xl">
						<h2 class="u-text-lg u-text-xl@sm">Dealing With Amounts</h2>
				</div>
			</div>
		</div>
		<div class="o-container">
			<div class="o-row">
				
					<div class="o-col-12@lg o-col-11@xl">
						<div class="c-post u-mb-3@lg js-post">
							<p>Dealing with money and all possible currencies can be quite a complex task. The AppFlow <code class="highlighter-rouge">Amounts</code> object can help you deal with money within flows in a simple and standardised way.</p>

<h2 id="amount-units-and-currencies">Amount units and currencies</h2>

<p>To keep the AppFlow models as simple as possible, money is represented as follows</p>

<ul>
  <li>Amount value as a <code class="highlighter-rouge">long</code> representing the <em>base unit</em> for that currency</li>
  <li>An associated <code class="highlighter-rouge">ISO-4217</code> three-letter currency code</li>
</ul>

<p><code class="highlighter-rouge">ISO-4217</code> defines currencies via a currency number, code and more importantly in this case, the fraction relationship between the main unit and a sub-unit, if one exists. The sub-unit is what you would know as <em>cents</em>, <em>pence</em>, and so on. Not all currencies, like the Japanese Yen, have any sub-unit. See <a href="https://www.currency-iso.org/dam/downloads/lists/list_one.xml">ISO-4217 Definitions</a> for a list of currencies in this format.</p>

<p>Most currencies, such as the US Dollar, British Pound, EURO, etc all have a sub-unit with a fraction of 2, meaning that in the case of US Dollar, 10 dollars equals 1000 cents.</p>

<p>The amount value in AppFlow is defined as <em>the main unit times the sub-unit fraction</em>, so in the example above, a client would pass <code class="highlighter-rouge">1000</code> (10 * 100) for the currency code <code class="highlighter-rouge">USD</code>.</p>

<p>It is up to each application to manage the currencies correctly, which is fairly easily done with the help of the Java <code class="highlighter-rouge">Currency</code> class with which you can query for the sub-unit fractions. The snippet below shows how you can find out what the fraction is, and via <code class="highlighter-rouge">BigDecimal</code> easily represent that for purposes such as retrieving a human readable representation, etc.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">long</span> <span class="n">amountValue</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">;</span>
<span class="n">String</span> <span class="n">currencyCode</span> <span class="o">=</span> <span class="s">"USD"</span><span class="o">;</span>
<span class="n">Currency</span> <span class="n">currency</span> <span class="o">=</span> <span class="n">Currency</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">currencyCode</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">subUnitFraction</span> <span class="o">=</span> <span class="n">currency</span><span class="o">.</span><span class="na">getDefaultFractionDigits</span><span class="o">();</span> <span class="c1">// This will return 2 for USD</span>
<span class="n">BigDecimal</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">amountValue</span><span class="o">).</span><span class="na">movePointLeft</span><span class="o">(</span><span class="n">subUnitFraction</span><span class="o">);</span>
<span class="n">String</span> <span class="n">readableAmount</span> <span class="o">=</span> <span class="n">currency</span><span class="o">.</span><span class="na">getSymbol</span><span class="o">()</span> <span class="o">+</span> <span class="n">amount</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span> <span class="c1">// "$10.00</span>
</code></pre></div></div>

<h2 id="amounts-structure">Amounts structure</h2>
<p>The <code class="highlighter-rouge">Amounts</code> class consists of three main entities</p>
<ul>
  <li>A base amount</li>
  <li>Additional amounts</li>
  <li>Currency</li>
</ul>

<p>In addition, it contains the following fields for supporting currency conversions</p>
<ul>
  <li>Currency exchange rate</li>
  <li>Original currency</li>
</ul>

<p>The <code class="highlighter-rouge">baseAmount</code> represents the actual value of goods and services. If a basket is set, the <code class="highlighter-rouge">baseAmount</code> will reflect the basket total value. On top of this base amount, there may be <em>additional amounts</em> for scenarios such as</p>
<ul>
  <li>tipping</li>
  <li>cashback</li>
  <li>fees</li>
  <li>charity donations</li>
  <li>etc</li>
</ul>

<p>See <a href="/pos-android-sdk/technical/additional-amounts">Additional Amounts</a> for a list of defined identifiers.</p>

<p>The <em>total amount</em> (<code class="highlighter-rouge">Amounts.getTotalAmount()</code>) will reflect the base amount + all additional amounts.</p>

<p>There may be scenarios (often in payment applications), where some additional amounts are supported natively in that environment, but not others. As an example, many payment hosts/gateways supports setting tip and cashback as individual fields in the host message, but would rarely support something like charity donation. For these cases, the <code class="highlighter-rouge">getTotalExcludingAmounts(String... amountsIdentifiers)</code> is a useful method to help calculate a base amount that includes some additional amounts. Below is an example that reflects the above scenario</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Input amounts</span>
<span class="n">Amounts</span> <span class="n">amounts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Amounts</span><span class="o">(</span><span class="mi">1000</span><span class="o">,</span> <span class="s">"EUR"</span><span class="o">);</span>
<span class="n">amounts</span><span class="o">.</span><span class="na">addAdditionalAmount</span><span class="o">(</span><span class="s">"tip"</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>
<span class="n">amounts</span><span class="o">.</span><span class="na">addAdditionalAmount</span><span class="o">(</span><span class="s">"cashback"</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>
<span class="n">amounts</span><span class="o">.</span><span class="na">addAdditionalAmount</span><span class="o">(</span><span class="s">"charityDonation"</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>

<span class="c1">// Extract relevant amounts</span>
<span class="c1">// baseAmount now includes base and charityDonation, but not tip and cashback</span>
<span class="kt">long</span> <span class="n">baseAmount</span> <span class="o">=</span> <span class="n">amounts</span><span class="o">.</span><span class="na">getTotalExcludingAmounts</span><span class="o">(</span><span class="s">"tip"</span><span class="o">,</span> <span class="s">"cashback"</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">tip</span> <span class="o">=</span> <span class="n">amounts</span><span class="o">.</span><span class="na">getAdditionalAmountValue</span><span class="o">(</span><span class="s">"tip"</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">cashback</span> <span class="o">=</span> <span class="n">amounts</span><span class="o">.</span><span class="na">getAdditionalAmountValue</span><span class="o">(</span><span class="s">"cashback"</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">amounts</span><span class="o">.</span><span class="na">getTotalAmountValue</span><span class="o">();</span>

</code></pre></div></div>

<h2 id="zero-base-amount-value">Zero base amount value</h2>
<p>Due to the ability for flow services to pay off amounts and that AppFlow does not block zero-based requests, it is possible that the <code class="highlighter-rouge">TransactionRequest</code> amounts will have a <em>base amount value</em> of zero.
For payment applications specifically, applications will never be called if the <em>total</em> if zero, but if the base amount is zero and there are additional amounts left to pay (such as tip or fees), then your payment application will still be called and must be able to handle this scenario.</p>

							

						</div><!-- /.c-post -->
					</div><!-- /.o-col -->
				
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->




		
			<footer class="c-footer">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12 u-mt-6 u-mt-8@md u-mb-4 u-mb-6@md">
							
								<p class="c-logo u-mb-1">
									AEVI AppFlow
								</p><!-- /.c-logo -->
							
							
								<p>Copyright &copy;2019. - AEVI International GmbH <br>All rights reserved.</p>
							
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</footer><!-- /.c-footer -->
		

		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/vendor/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/scripts.min.js"></script>

		

	</body>
</html>

