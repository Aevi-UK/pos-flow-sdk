

<!DOCTYPE html>

	<html lang="en-GB">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		
			<title>Handling Tax | AEVI AppFlow</title>
		
		
		
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:400,400i,500,500i,700,700i">
		<link rel="stylesheet" href="/pos-android-sdk/dox-theme/assets/css/style.css">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="32x32">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="192x192">
		<link rel="apple-touch-icon-precomposed" href="/pos-android-sdk/icon_large.png">
		<meta name="msapplication-TileImage" content="/pos-android-sdk/icon_large.png">
	</head>
	<body>
		
			<div class="c-offcanvas">
				<div class="c-offcanvas__inner">
					
						<ul class="c-nav c-nav--stacked u-mx-auto">
							
								<li><a href="/pos-android-sdk/intro">Introduction</a></li>
							
								<li><a href="/pos-android-sdk/explore">Explore</a></li>
							
								<li><a href="/pos-android-sdk/downloads">Downloads</a></li>
							
								<li><a href="/pos-android-sdk/support">Support</a></li>
							
						</ul><!-- /.c-nav -->
					
					
						
							<a href="/reference" class="c-btn c-btn--md c-btn--gray u-text-md">
								Reference
								<div class="c-btn__icon">
									<i class="o-icon o-icon--folder"></i>
								</div>
							</a>
						
					
				</div><!-- /.c-offcanvas__inner -->
			</div><!-- /.c-offcanvas -->
		

		
			<header class="c-header u-text-white">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12">
							<div class="u-flex u-items-center">
								
									<div class="c-logo">
										<a href="/pos-android-sdk/" class="c-logo__link">
											<img src="/pos-android-sdk/aevi_logo.svg">
										</a><!-- /.c-logo__link -->
									</div><!-- /.c-logo -->
								
								
									<div class="u-flex u-items-center u-ml-auto">
										
											<ul class="c-nav u-mb-0 u-hidden u-block@lg">
												
													
													<li class=""><a href="/pos-android-sdk/intro">Introduction</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/explore">Explore</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/downloads">Downloads</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/support">Support</a></li>
												
											</ul><!-- /.c-nav -->
										
										
											<div class="u-ml-5 u-hidden u-block@lg">
												
													<a href="/pos-android-sdk/reference" class="c-btn c-btn--md c-btn--white u-text-md">
														Reference
														<div class="c-btn__icon">
															<i class="o-icon o-icon--folder"></i>
														</div>
													</a>
												
											</div>
										
									</div>
								
								<button class="c-hamburger-icon c-hamburger-icon--slider js-hamburger-icon js-offcanvas-toggle u-ml-auto u-hidden@lg" type="button">
									<span class="c-hamburger-icon__box">
										<span class="c-hamburger-icon__inner"></span>
									</span><!-- /.c-hamburger-icon__box -->
								</button><!-- /.c-hamburger-icon -->
							</div>
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</header><!-- /.c-header -->
		


<div class="u-bg-primary u-text-white u-pt-8 u-pb-10">
</div>


		<div class="o-container">
			<div class="o-row">
				<div class="o-col-8@lg o-col-7@xl">
						<h2 class="u-text-lg u-text-xl@sm">Handling Tax</h2>
				</div>
			</div>
		</div>
		<div class="o-container">
			<div class="o-row">
				
					<div class="o-col-12@lg o-col-11@xl">
						<div class="c-post u-mb-3@lg js-post">
							<p>Tax is applied to goods and services around the world and requires special attention in some regions. AppFlow itself does not require or make use of tax amounts as a concept, but supports it being defined where required. Note that in general all amounts are <em>inclusive</em> of tax in AppFlow. This is the case for the <code class="highlighter-rouge">Amount</code> and <code class="highlighter-rouge">Amounts</code> classes, as well as the <code class="highlighter-rouge">amount</code> in <code class="highlighter-rouge">BasketItem</code>, etc. Any tax information provided is simply a breakdown of what tax is applied to those amounts.</p>

<p>Tax information can be applied in two ways - <a href="https://github.com/AEVI-AppFlow/api-constants/blob/master/api-constants/src/main/java/com/aevi/sdk/flow/models/TaxInfo.java">TaxInfo</a> added to additional data for any model that supports this, or as a modifier to a basket item. Note that the <code class="highlighter-rouge">TaxInfo</code> is part of the <code class="highlighter-rouge">api-constants</code> library (v2.2.1+) and not the core AppFlow APIs.</p>

<div class="callout callout--warning">
  <p>AppFlow does not validate that any tax information provided is accurate with regards to the amounts and/or basket it is associated with. It is up to the client to ensure the tax information passed is correct.</p>
</div>

<h2 id="providing-tax-information">Providing tax information</h2>

<p>If your application is providing amounts and/or a basket, it may also be relevant to attach tax information.</p>

<p>Tax information can be applied either to the overall request (which is usally a <code class="highlighter-rouge">Payment</code>) with the use of <code class="highlighter-rouge">TaxInfo</code>, or per individual basket item with the use of <em>modifiers</em>.</p>

<p>If you are providing a basket, it is always recommended to do this per basket item if possible, as this allows for different tax rates to be applied on an item basis.</p>

<h3 id="applying-taxinfo">Applying TaxInfo</h3>

<p>Both the <code class="highlighter-rouge">taxAmount</code> and<code class="highlighter-rouge">taxRates</code> are optional - a client can set what is available to them. The <code class="highlighter-rouge">taxAmount</code> represents the absolute tax amount, whereas a <code class="highlighter-rouge">TaxRate</code> indicates at what rate a specific type of tax is applied at, such as 20% VAT/GST. Multiple tax rates can be added to a single <code class="highlighter-rouge">TaxInfo</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">taxAmount</span> <span class="o">=</span> <span class="mf">5200.0f</span><span class="o">;</span>
<span class="n">TaxInfo</span> <span class="n">taxInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TaxInfo</span><span class="o">(</span><span class="n">taxAmount</span><span class="o">,</span> <span class="k">new</span> <span class="n">TaxRate</span><span class="o">(</span><span class="mf">0.20f</span><span class="o">,</span> <span class="s">"VAT"</span><span class="o">),</span> <span class="k">new</span> <span class="n">TaxRate</span><span class="o">(</span><span class="mf">0.05f</span><span class="o">,</span> <span class="s">"Sugar"</span><span class="o">));</span>
</code></pre></div></div>

<p>To set in a <code class="highlighter-rouge">Payment</code>,</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paymentBuilder</span><span class="o">.</span><span class="na">addAdditionalData</span><span class="o">(</span><span class="s">"taxInfo"</span><span class="o">,</span> <span class="n">taxInfo</span><span class="o">);</span>
</code></pre></div></div>

<p>If the tax info is relevant for a generic request or status update,</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span><span class="o">.</span><span class="na">addAdditionalData</span><span class="o">(</span><span class="s">"taxInfo"</span><span class="o">,</span> <span class="n">taxInfo</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="per-basketitem">Per BasketItem</h3>

<p>Basket item supports the concept of modifiers as explained in the <a href="/pos-android-sdk/technical/using-basket">basket docs</a>. Any number of modifiers may be added to the item.</p>

<p>Either the absolute amount or the percentage must be set, but not both are required. If you have both values, it is recommended you set both. The amount can be set as a whole number or as a floating point (via <code class="highlighter-rouge">withFractionalAmount()</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BasketItemModifier</span> <span class="n">basketItemModifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasketItemModifierBuilder</span><span class="o">(</span><span class="s">"Value Added Tax"</span><span class="o">,</span> <span class="s">"tax"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">withAmount</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
  <span class="o">.</span><span class="na">withPercentage</span><span class="o">(</span><span class="mf">20.0f</span><span class="o">)</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">basketItemBuilder</span><span class="o">.</span><span class="na">withModifiers</span><span class="o">(</span><span class="n">basketItemModifier</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="reading-tax-information">Reading tax information</h2>

<p>As the tax information can be set in various ways, and different data can be available, it is important that your application checks for this properly.</p>

<h3 id="payment-flow">Payment Flow</h3>

<p>This assumes that you are a flow service with access to either the <code class="highlighter-rouge">Payment</code>, <code class="highlighter-rouge">TransactionRequest</code> or <code class="highlighter-rouge">TransactionSummary</code> models. The sample below uses the <code class="highlighter-rouge">TransactionSummary</code> as an example but the same mechanism can be applied to all three models. See <a href="/pos-android-sdk/technical/using-basket">basket docs</a> for more details on the basket items and basket modifiers.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">transactionSummary</span><span class="o">.</span><span class="na">getAdditionalData</span><span class="o">().</span><span class="na">hasData</span><span class="o">(</span><span class="s">"taxInfo"</span><span class="o">))</span> <span class="o">{</span>
  <span class="n">TaxInfo</span> <span class="n">overallTransactionTax</span> <span class="o">=</span> <span class="n">transactionSummary</span><span class="o">.</span><span class="na">getAdditionalData</span><span class="o">().</span><span class="na">getValue</span><span class="o">(</span><span class="s">"taxInfo"</span><span class="o">,</span> <span class="n">TaxInfo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">Basket</span> <span class="n">basket</span> <span class="o">=</span> <span class="n">transactionSummary</span><span class="o">.</span><span class="na">getPrimaryBasket</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">basket</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">BasketItem</span> <span class="n">basketItem</span> <span class="o">:</span> <span class="n">basketItems</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">BasketItemModifier</span><span class="o">&gt;</span> <span class="n">taxModifiers</span> <span class="o">=</span> <span class="n">getTaxModifiers</span><span class="o">(</span><span class="n">basketItem</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">taxModifiers</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="c1">// Check all modifiers and ensure to check for amount OR percentage being set</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">BasketItemModifier</span><span class="o">&gt;</span> <span class="nf">getTaxModifiers</span><span class="o">(</span><span class="n">BasketItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">BasketItemModifier</span><span class="o">&gt;</span> <span class="n">taxModifiers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Arraylist</span><span class="o">&lt;&gt;();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">hasModifiers</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">BasketItemModifier</span> <span class="n">modifier</span> <span class="o">:</span> <span class="n">item</span><span class="o">.</span><span class="na">getModifiers</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">modifier</span><span class="o">.</span><span class="na">getType</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"tax"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">taxModifiers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">modifier</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">taxModifiers</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="generic-flow">Generic Flow</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRequestData</span><span class="o">().</span><span class="na">hasData</span><span class="o">(</span><span class="s">"taxInfo"</span><span class="o">))</span> <span class="o">{</span>
	<span class="n">TaxInfo</span> <span class="n">overallRequestTax</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestData</span><span class="o">().</span><span class="na">getValue</span><span class="o">(</span><span class="s">"taxInfo"</span><span class="o">,</span> <span class="n">TaxInfo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="parsing-taxinfo">Parsing TaxInfo</h3>

<p>This assumes access to a <code class="highlighter-rouge">TaxInfo</code> instance via one of the methods above.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">taxInfo</span><span class="o">.</span><span class="na">getTaxAmount</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
 	<span class="kt">float</span> <span class="n">taxAmount</span> <span class="o">=</span> <span class="n">taxInfo</span><span class="o">.</span><span class="na">getTaxAmount</span><span class="o">();</span>
  <span class="c1">// Absolute tax amount for overall request OR basket item (depending on where it came from)</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">taxInfo</span><span class="o">.</span><span class="na">getTaxRates</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">TaxRate</span> <span class="n">taxRate</span> <span class="o">:</span> <span class="n">taxInfo</span><span class="o">.</span><span class="na">getTaxRates</span><span class="o">())</span> <span class="o">{</span>
    <span class="c1">// taxRate.getLabel(), taxRate.getRate());</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>


							

						</div><!-- /.c-post -->
					</div><!-- /.o-col -->
				
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->




		
			<footer class="c-footer">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12 u-mt-6 u-mt-8@md u-mb-4 u-mb-6@md">
							
								<p class="c-logo u-mb-1">
									AEVI AppFlow
								</p><!-- /.c-logo -->
							
							
								<p>Copyright &copy;2019. - AEVI International GmbH <br>All rights reserved.</p>
							
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</footer><!-- /.c-footer -->
		

		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/vendor/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/scripts.min.js"></script>

		

	</body>
</html>

