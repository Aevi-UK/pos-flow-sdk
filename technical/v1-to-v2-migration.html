

<!DOCTYPE html>

	<html lang="en-GB">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		
			<title>AppFlow v1 to v2 Migration | AEVI AppFlow</title>
		
		
		
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:400,400i,500,500i,700,700i">
		<link rel="stylesheet" href="/pos-android-sdk/dox-theme/assets/css/style.css">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="32x32">
		<link rel="icon" href="/pos-android-sdk/icon_large.png" sizes="192x192">
		<link rel="apple-touch-icon-precomposed" href="/pos-android-sdk/icon_large.png">
		<meta name="msapplication-TileImage" content="/pos-android-sdk/icon_large.png">
	</head>
	<body>
		
			<div class="c-offcanvas">
				<div class="c-offcanvas__inner">
					
						<ul class="c-nav c-nav--stacked u-mx-auto">
							
								<li><a href="/pos-android-sdk/intro">Introduction</a></li>
							
								<li><a href="/pos-android-sdk/explore">Explore</a></li>
							
								<li><a href="/pos-android-sdk/downloads">Downloads</a></li>
							
								<li><a href="/pos-android-sdk/support">Support</a></li>
							
						</ul><!-- /.c-nav -->
					
					
						
							<a href="/reference" class="c-btn c-btn--md c-btn--gray u-text-md">
								Reference
								<div class="c-btn__icon">
									<i class="o-icon o-icon--folder"></i>
								</div>
							</a>
						
					
				</div><!-- /.c-offcanvas__inner -->
			</div><!-- /.c-offcanvas -->
		

		
			<header class="c-header">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12">
							<div class="u-flex u-items-center">
								
									<div class="c-logo">
										<a href="/pos-android-sdk/" class="c-logo__link">
											<img src="/pos-android-sdk/aevi_logo.svg">
										</a><!-- /.c-logo__link -->
									</div><!-- /.c-logo -->
								
								
									<div class="u-flex u-items-center u-ml-auto">
										
											<ul class="c-nav u-mb-0 u-hidden u-block@lg">
												
													
													<li class=""><a href="/pos-android-sdk/intro">Introduction</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/explore">Explore</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/downloads">Downloads</a></li>
												
													
													<li class=""><a href="/pos-android-sdk/support">Support</a></li>
												
											</ul><!-- /.c-nav -->
										
										
											<div class="u-ml-5 u-hidden u-block@lg">
												
													<a href="/pos-android-sdk/reference" class="c-btn c-btn--md c-btn--gray u-text-md">
														Reference
														<div class="c-btn__icon">
															<i class="o-icon o-icon--folder"></i>
														</div>
													</a>
												
											</div>
										
									</div>
								
								<button class="c-hamburger-icon c-hamburger-icon--slider js-hamburger-icon js-offcanvas-toggle u-ml-auto u-hidden@lg" type="button">
									<span class="c-hamburger-icon__box">
										<span class="c-hamburger-icon__inner"></span>
									</span><!-- /.c-hamburger-icon__box -->
								</button><!-- /.c-hamburger-icon -->
							</div>
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</header><!-- /.c-header -->
		


<div class="u-bg-gray-30 u-pt-8 u-pb-10">
</div>


		<div class="o-container">
			<div class="o-row">
				<div class="o-col-8@lg o-col-7@xl">
						<h2 class="u-text-lg u-text-xl@sm">AppFlow v1 to v2 Migration</h2>
				</div>
			</div>
		</div>
		<div class="o-container">
			<div class="o-row">
				
					<div class="o-col-12@lg o-col-11@xl">
						<div class="c-post u-mb-3@lg js-post">
							<p>The second version of these APIs contain some breaking changes that means you will have to adapt your application if it is currently integrated with the first version. As a general rule - review the samples if unsure about what to do.</p>

<h2 id="api-structure">API structure</h2>
<p>The in v1 separate APIs <code class="highlighter-rouge">payment-service-api</code> and <code class="highlighter-rouge">flow-service-api</code> have been merged in this version into a new <code class="highlighter-rouge">payment-flow-service-api</code>.</p>

<p>This means you have to update your dependencies accordingly to use <code class="highlighter-rouge">com.aevi.sdk.pos.flow:payment-flow-service-api:&lt;version&gt;</code> instead.</p>

<p>There is no longer any major distinction between what was previously known as flow services (aka VAAs) and  payment services. A service simply defines what stages it wants to support and that determines what function(s) they can provide. A traditional payment application is a service that gets called during the <code class="highlighter-rouge">TRANSACTION_PROCESSING</code> stage, and optionally <code class="highlighter-rouge">PAYMENT_CARD_READING</code> and <code class="highlighter-rouge">GENERIC</code>.</p>

<h3 id="api-clients">API clients</h3>

<p><code class="highlighter-rouge">FlowClient</code> has been removed and all methods are now defined in <code class="highlighter-rouge">PaymentClient</code> to improve clarity of where to find things (in particular for JavaDocs). In addition, we have the following client changes</p>
<ul>
  <li><code class="highlighter-rouge">getSystemSettings()</code>, <code class="highlighter-rouge">getFlowServices()</code> and <code class="highlighter-rouge">getPaymentServices()</code> replaced by <code class="highlighter-rouge">getPaymentSettings()</code></li>
  <li><code class="highlighter-rouge">subscribeToStatusUpdates()</code> and <code class="highlighter-rouge">getCurrentRequestStatus()</code> removed as there was no use case for them</li>
  <li><code class="highlighter-rouge">processRequest()</code> renamed to <code class="highlighter-rouge">initiateRequest()</code> to follow <code class="highlighter-rouge">initiatePayment()</code> naming</li>
</ul>

<p><strong>Important</strong>, the initiate method return types have also changed from <code class="highlighter-rouge">Single</code> to <code class="highlighter-rouge">Completable</code>. Read more at <a href="/pos-android-sdk/guides/pos/handling-responses">Handling responses</a>.</p>

<h2 id="service--activity-changes">Service / activity changes</h2>
<p>There is no longer any need to define a service per stage, and the previous base services like <code class="highlighter-rouge">BasePreFlowService</code> etc are all gone.</p>

<p>This has been replaced with a new concept of “stage models”, which are independent components that can be created from both service and activity contexts and provide all the relevant functions specifically for that stage. See <a href="https://github.com/Aevi-UK/pos-flow-sdk/blob/master/payment-flow-service-api/src/main/java/com/aevi/sdk/pos/flow/stage/PreTransactionModel.java">PreTransactionModel</a> as an example. There is one of these defined for each stage.</p>

<p>There is a new <code class="highlighter-rouge">BasePaymentFlowService</code> which can be extended for cases where processing should be service based. All that is required is that you override the correct method, like <code class="highlighter-rouge">onPreTransaction(PreTransactionModel)</code> and use the intent filter for that, and you will get a callback into that method when a request comes in. See <a href="https://github.com/Aevi-UK/pos-flow-sdk/blob/master/PaymentServiceSample/src/main/java/com/aevi/sdk/pos/flow/paymentservicesample/service/PaymentService.java">PaymentService</a> as an example of this.</p>

<p>In addition, there is a new solution for processing requests in an activity via another new service, <code class="highlighter-rouge">ActivityProxyService</code>, that can be used to proxy <em>any</em> request onto an activity. This is to avoid the boilerplate services that exists purely to sit between FPS and an activity. The <code class="highlighter-rouge">ActivityProxyService</code> can be defined to handle any number of stages, and proxies requests on to activities with the relevant stage intent action. See <a href="https://github.com/Aevi-UK/pos-flow-sdk/blob/master/FlowServiceSample/src/main/AndroidManifest.xml#L31">FlowServiceSample manifest</a> for examples of how this is defined in the flow service sample (do note though that it is using a subclass of the API service to add function - this is not required).</p>

<p>The activities then add intent filters relevant for the stage it wants to handle, like <code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_PRE_TRANSACTION_IN_ACTIVITY</code>.</p>

<p>See <a href="/pos-android-sdk/guides/vaa/implementing-flow-services">Implementing Flow Services</a> for documentation around this.</p>

<h2 id="manifest-changes">Manifest changes</h2>
<h3 id="intent-actions">Intent actions</h3>
<p>All intent actions have been updated to be consistent.</p>

<p>See <a href="https://github.com/Aevi-UK/pos-flow-sdk/blob/master/flow-base-api/src/main/java/com/aevi/sdk/flow/constants/IntentActions.java">IntentActions</a> for the full list of action names to use in the manifest now.</p>

<p>Remember to update all your services and content providers or FPS won’t find them.</p>

<h3 id="payment-services">Payment services</h3>
<p>Payment services, as in services that support transaction processing, which previously used the <code class="highlighter-rouge">payment-service-api</code>, no longer needs to define the <code class="highlighter-rouge">configuration-authority</code> meta-data for the service that implements the old <code class="highlighter-rouge">com.aevi.sdk.pos.flow.action.PROCESS_PAYMENT</code>. (The intent action should be replaced with <code class="highlighter-rouge">com.aevi.sdk.flow.action.PROCESS_TRANSACTION</code>)</p>

<p>Instead, your applications needs to update the intent filter for the service info provider to
<code class="highlighter-rouge">com.aevi.sdk.flow.action.PROVIDE_SERVICE_INFO</code></p>

<h3 id="flow-services">Flow services</h3>
<p>Flow services also need to update the intent action for their service info provider to
<code class="highlighter-rouge">com.aevi.sdk.flow.action.PROVIDE_SERVICE_INFO</code></p>

<h2 id="service-info-providers">Service info providers</h2>
<p>As the APIs are merged, there is now also a single base service info provider that you need to extend from, and a single builder class to generate your service info.</p>

<p><code class="highlighter-rouge">public class SampleServiceInfoProvider extends BasePaymentFlowServiceInfoProvider</code></p>

<p>And the builder to use now for all flow services is <code class="highlighter-rouge">PaymentFlowServiceInfoBuilder</code>.</p>

<h3 id="changes-to-service-info-builder">Changes to service info builder</h3>
<ul>
  <li><code class="highlighter-rouge">withSupportedRequestTypes()</code> and <code class="highlighter-rouge">withSupportedTransactionTypes()</code> have been replaced by the two methods below</li>
  <li>New method <code class="highlighter-rouge">withCustomRequestTypes()</code> that allows any flow service to define custom/bespoke request types, if any. Example is <code class="highlighter-rouge">showLoyaltyPointsBalance</code> from the samples. Should not be called unless there are custom types.</li>
  <li>New method <code class="highlighter-rouge">withSupportedFlowTypes()</code> allows a flow service to report which of the pre-defined flow types are supported, if any. See <a href="/pos-android-sdk/request-types">Flow Types</a> for more info.</li>
  <li><code class="highlighter-rouge">withPaymentMethods()</code> replaced by <code class="highlighter-rouge">withCanPayAmounts(boolean, paymentMethods)</code></li>
  <li>Support to set any custom / arbitrary data via <code class="highlighter-rouge">withAdditionalInfo()</code></li>
</ul>

<p>For payment service migration, note the following changes</p>

<ul>
  <li><code class="highlighter-rouge">withTerminalId()</code> removed - use AEVI DMS API for retrieving device ids</li>
  <li>New merchants model to represent merchants, use <code class="highlighter-rouge">withMerchants(Merchant... merchants)</code></li>
  <li><code class="highlighter-rouge">withManualEntrySupport()</code> and <code class="highlighter-rouge">withPrintsReceipts()</code> can now be set as additional data</li>
</ul>

<h2 id="transaction-ids">Transaction ids</h2>
<p>The way transaction ids are managed have changed a bit. See [Transactions]((/pos-android-sdk/technical/transactions) for details.</p>

<h2 id="specifying-a-payment-app">Specifying a payment app</h2>
<p>There is no longer a way to specify a <code class="highlighter-rouge">payment service</code> via an id as per before, as flow configs alone now determine what applications are available for any flow and stage.</p>

<h3 id="request---flow-mapping">Request -&gt; flow mapping</h3>
<p>The way flows are managed has changed in order to improve its flexibility. The previous <code class="highlighter-rouge">withTransactionType()</code> method in <code class="highlighter-rouge">PaymentBuilder</code> has been replaced by two new methods - <code class="highlighter-rouge">withPaymentFlow(String flowType)</code> and <code class="highlighter-rouge">withPaymentFlow(String flowType, String flowName)</code>. This is due to new support for multiple flows per type. A client can still set the type only and FPS will map that to available flows, which will only be one match in the majority of cases. In cases where there is more than one flow per type, a runtime selection dialog will be presented to allow the merchant/operator to choose.</p>

<p>For development, testing, prototyping, etc, setting the type only is the best approach. However, for production scenarios it is generally recommended to also explicitly specify the flow to use. In most acquirer environments the defined flows will be known up front and that information is provided to all developers.</p>

<h2 id="various-other-model-changes">Various other model changes</h2>

<p>There are too many minor changes to the models to cover here, so please see the change log for more details.</p>

<ul>
  <li>PaymentStage enum is gone and replaced by the FlowStages string definitions</li>
  <li>TransactionRequest.getPaymentStage() now getFlowStage() and returns a string instead</li>
  <li>Basket and Customer are now first level citizens in Payment and TransactionRequest</li>
  <li>There can now be more than one basket, as any “upsells” provided by flow services will be represented in individual baskets</li>
  <li>TransactionRequest has a new getTransactionId() method that returns the id for the whole transaction</li>
</ul>

							

						</div><!-- /.c-post -->
					</div><!-- /.o-col -->
				
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->




		
			<footer class="c-footer">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12 u-mt-6 u-mt-8@md u-mb-4 u-mb-6@md">
							
								<p class="c-logo u-mb-1">
									AEVI AppFlow
								</p><!-- /.c-logo -->
							
							
								<p>Copyright &copy;2019. - AEVI International GmbH <br>All rights reserved.</p>
							
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</footer><!-- /.c-footer -->
		

		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/vendor/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="/pos-android-sdk/dox-theme/assets/js/scripts.min.js"></script>

		

	</body>
</html>

